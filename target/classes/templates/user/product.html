<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Ë¥≠Áâ©ÂïÜÂüé-ÂïÜÂìÅÂàóË°®</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"
          onerror="this.onerror=null;this.href='css/bootstrap.min.css';">
    <!-- Bootstrap ÂõæÊ†á -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"
          onerror="this.onerror=null;">
    <!-- Â∑≤ÊúâÁöÑÊú¨Âú∞ÂºïÁî®‰øùÁïô‰Ωú‰∏∫Â§áÈÄâ -->
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet" id="bootstrap-local" disabled>
    <!-- Bootstrap ÂõæÊ†á Êú¨Âú∞ÈìæÊé• -->
    <link rel="stylesheet" th:href="@{/css/bootstrap-icons.css}" id="bootstrap-icons-local" disabled>
    <!-- Ëá™ÂÆö‰πâÊ†∑Âºè -->
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/product.css}">

</head>
<body class="d-flex flex-column min-vh-100">
<!-- ÂØºËà™Ê†è  -->
<nav th:insert="~{commons/commons :: navbar}"
     style=" top: 0; left: 100px; right: 0;"></nav>

<!-- ‰∏ªË¶ÅÂÜÖÂÆπ -->
<main class="flex-grow-1 main-container" style="margin-top: 10px;">
    <div class="container">
        <!--    Èù¢ÂåÖÂ±ë-->
        <nav aria-label="breadcrumb" class="mt-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/u/index.html}">È¶ñÈ°µ</a></li>
                <li class="breadcrumb-item active" aria-current="page">ÂïÜÂìÅÂàóË°®</li>
            </ol>
        </nav>
        <!-- Á≠õÈÄâÊ†è -->
        <form method="get" th:action="@{/u/goproduct}">
            <div class="filter-bar">
                <select class="form-select" name="category">
                    <option value="">ÊâÄÊúâÂàÜÁ±ª</option>
                    <option th:each="GoodsType : ${goodstypeList}"
                            th:text="${GoodsType.getGoodsTypeName()}"
                            th:value="${GoodsType.getGoodsTypeId()}"
                            th:selected="${#strings.toString(GoodsType.getGoodsTypeId()) == category}">
                    </option>
                </select>

                <select class="form-select" name="priceRange">
                    <option value="">‰ª∑Ê†ºÂå∫Èó¥</option>
                    <option value="0-100" th:selected="${priceRange == '0-100'}">Ôø•0 - Ôø•100</option>
                    <option value="100-500" th:selected="${priceRange == '100-500'}">Ôø•100 - Ôø•500</option>
                    <option value="500" th:selected="${priceRange == '500'}">Ôø•500‰ª•‰∏ä</option>
                </select>

                <select class="form-select" name="sortOrder">
                    <option value="">ÊéíÂ∫èÊñπÂºè</option>
                    <option value="price_asc" th:selected="${sortOrder == 'price_asc'}">‰ª∑Ê†º‰ªé‰ΩéÂà∞È´ò</option>
                    <option value="price_desc" th:selected="${sortOrder == 'price_desc'}">‰ª∑Ê†º‰ªéÈ´òÂà∞‰Ωé</option>
                    <option value="sales" th:selected="${sortOrder == 'sales'}">ÈîÄÈáè‰ºòÂÖà</option>
                    <option value="newest" th:selected="${sortOrder == 'newest'}">ÊúÄÊñ∞‰∏äÊû∂</option>
                </select>
                <button type="submit" class="btn">Á≠õÈÄâ</button>
                <span class="product-count">ÂÖ± <span th:text="${count}"></span> ‰ª∂ÂïÜÂìÅ</span>
            </div>
        </form>


        <!-- ÂïÜÂìÅÂ±ïÁ§∫ÂàóË°® -->
        <div class="container">
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4" id="product-list">
                <!-- Âçï‰∏™ÂïÜÂìÅÂç°ÁâáÂæ™ÁéØ -->
                <div th:each="goods : ${goodsList}" class="col">
                    <div class="card h-100 shadow-sm" style="border-color: rgba(255, 87, 34, 0.2); position: relative;">
                        <!-- Êï¥‰∏™Âç°ÁâáÂèØÁÇπÂáªÂå∫Âüü -->
                        <a th:href="@{/u/detail/{id}(id=${goods.getGoodsId()})}"
                           class="stretched-link text-decoration-none"
                           style="color: inherit; z-index: 1;">
                            <!-- ÂïÜÂìÅÁä∂ÊÄÅÊèêÁ§∫ -->
                            <div class="position-absolute top-0 start-0 p-2" style="z-index: 2;">
                                <!-- Áä∂ÊÄÅÊ†áÁ≠æÂÜÖÂÆπ‰øùÊåÅ‰∏çÂèò -->
                                <span th:if="${goods.datetimeHoursDiff <= 72}"
                                      class="badge"
                                      style="background: rgba(255, 87, 34, 0.9);">Êñ∞ÂìÅ‰∏äÂ∏Ç</span>
                                <span th:if="${goods.getInventory() < 50}"
                                      class="badge mb-1"
                                      style="background-color: rgba(255, 87, 34, 0.6); color: white;"
                                      th:text="'‰ªÖÂâ©'+${goods.getInventory}+'‰ª∂'"></span>
                                <span th:if="${goods.updateHoursDiff <= 24}"
                                      class="badge"
                                      style="background: rgba(255, 87, 34, 0.9);">ÁÉ≠Âçñ‰∏≠üî•</span>
                            </div>

                            <!-- ÂïÜÂìÅÂõæÁâá -->
                            <div style="height: 200px; flex-shrink: 0;">
                                <img th:src="${goods.getImageUrl()}"
                                     class="card-img-top h-100 w-100"
                                     style="object-fit: contain; padding: 12px;">
                            </div>

                            <!-- Âç°ÁâáÂÜÖÂÆπ -->
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title fs-6"
                                    style="color: rgb(255, 87, 34);"
                                    th:text="${goods.getGoodsName()}"></h5>

                                <div class="d-flex justify-content-between small text-muted">
                                    <span th:text="'‰ªãÁªç: ' + ${goods.getDescription()}"></span>
                                </div>

                                <div class="mt-auto">
                                    <p class="price fw-bold mb-2"
                                       style="color: rgb(255, 87, 34);"
                                       th:text="'Ôø•' + ${#numbers.formatDecimal(goods.getPrice(), 1, 2)}"></p>
                                </div>
                            </div>
                        </a>

                        <!-- Áã¨Á´ãÂÆö‰ΩçÁöÑË¥≠Áâ©ËΩ¶ÊåâÈíÆ -->
                        <div class="position-absolute bottom-0 end-0 m-2" style="z-index: 2;">
                            <button class="btn cart-btn"
                                    style="background-color: #ff5722; color: white;"
                                    th:data-delete-url="@{/u/addToCart/{id}(id=${goods.getGoodsId()})}"
                                    onclick="confirmDelete(event)">
                                <i class="bi bi-cart-plus"></i>
                                Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ÂàÜÈ°µÁªÑ‰ª∂ -->
        <nav aria-label="Page navigation" class="d-flex justify-content-center mt-4">
            <ul class="pagination">
                <!-- ‰∏ä‰∏ÄÈ°µ -->
                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled' : ''">
                    <a class="page-link"
                       th:href="@{/u/goproduct(page=${currentPage - 1}, size=${size}, priceRange=${priceRange}, sortOrder=${sortOrder}, category=${category})}"
                       aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>

                <!-- È°µÁ†Å -->
                <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
                    th:classappend="${i == currentPage} ? 'active' : ''">
                    <a class="page-link"
                       th:href="@{/u/goproduct(page=${i}, size=${size}, priceRange=${priceRange}, sortOrder=${sortOrder}, category=${category})}"
                       th:text="${i}"></a>
                </li>

                <!-- Ë∑≥ËΩ¨Ë°®Âçï -->
                <li class="page-item">
                    <form th:action="@{/u/goproduct}" method="get" class="d-flex">
                        <input type="number" name="page" class="form-control me-2"
                               style="width: 80px;" min="1" th:max="${totalPages}" required>
                        <input type="hidden" name="size" th:value="${size}">
                        <!-- Êñ∞Â¢ûÈöêËóèÂ≠óÊÆµ -->
                        <input type="hidden" name="priceRange" th:value="${priceRange}">
                        <input type="hidden" name="sortOrder" th:value="${sortOrder}">
                        <input type="hidden" name="category" th:value="${category}">
                        <button type="submit" class="btn btn-primary">Ë∑≥ËΩ¨</button>
                    </form>
                </li>

                <!-- ‰∏ã‰∏ÄÈ°µ -->
                <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled' : ''">
                    <a class="page-link"
                       th:href="@{/u/goproduct(page=${currentPage + 1}, size=${size}, priceRange=${priceRange}, sortOrder=${sortOrder}, category=${category})}"
                       aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>

    </div>
</main>

<!-- È°µËÑö (ÂßãÁªàÂú®Â∫ïÈÉ®) -->
<footer th:insert="~{commons/commons :: footer}"
        style="
               bottom: 0;
               left: 0;
               width: 100%;
               z-index: 1040;  /* È´ò‰∫é‰æßËæπÊ†èÁöÑz-index */
              "> <!-- Ê∑ªÂä†ËÉåÊôØËâ≤Á°Æ‰øùË¶ÜÁõñ -->
</footer>
<!-- Bootstrap Êú¨Âú∞ -->
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<!-- jQuery -->
<script th:src="@{/js/jquery-3.7.1.min.js}"></script>
<!--Axios-->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<!-- Ëá™ÂÆö‰πâËÑöÊú¨ -->
<script th:src="@{/js/script.js}"></script>
<script>
    function confirmDelete(event) {
        const deleteUrl = event.currentTarget.getAttribute('data-delete-url');
        window.location.href = deleteUrl;

    }
</script>
</body>

</html>
